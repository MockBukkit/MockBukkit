package be.seeseemelk.mockbukkit.block.state;

import be.seeseemelk.mockbukkit.MockBukkit;
import be.seeseemelk.mockbukkit.WorldMock;
import be.seeseemelk.mockbukkit.block.BlockMock;
import org.bukkit.Location;
import org.bukkit.Material;
import org.bukkit.block.Block;
import org.bukkit.block.BlockState;
import org.bukkit.block.Chest;
import org.junit.After;
import org.junit.Before;
import org.junit.Test;

import static org.junit.Assert.*;

public class BlockStateMockTest
{

    @Before
    public void setUp() throws Exception
    {
        MockBukkit.mock();
    }

    @After
    public void tearDown() throws Exception
    {
        MockBukkit.unmock();
    }

    @Test
    public void testPlaced()
    {
        Location location = new Location(new WorldMock(), 400, 100, 1200);
        Block block = new BlockMock(Material.DIRT, location);
        BlockState state = block.getState();

        assertNotNull(state);
        assertTrue(state.isPlaced());
        assertEquals(block, state.getBlock());

        assertEquals(block.getType(), state.getType());
        assertEquals(location, state.getLocation());
        assertEquals(block.getWorld(), state.getWorld());
        assertEquals(block.getX(), state.getX());
        assertEquals(block.getY(), state.getY());
        assertEquals(block.getZ(), state.getZ());
    }

    @Test
    public void getBlockNotPlaced()
    {
        BlockState state = new BlockStateMock(Material.SAND);
        assertFalse(state.isPlaced());
    }

    @Test(expected = IllegalStateException.class)
    public void getBlockNotPlacedException()
    {
        BlockState state = new BlockStateMock(Material.SAND);
        state.getBlock();
    }

    @Test
    public void testUpdateWrongType()
    {
        Block block = new BlockMock(Material.CHEST);
        BlockState chest = new ChestMock(block);
        block.setType(Material.IRON_BLOCK);
        assertFalse(chest.update());
    }

    @Test
    public void testUpdateNotPlacedReturnsTrue()
    {
        BlockState state = new BlockStateMock(Material.IRON_BLOCK);
        assertFalse(state.isPlaced());
        assertTrue(state.update());
    }

    @Test
    public void testUpdateForce()
    {
        Block block = new BlockMock(Material.CHEST);
        BlockState chest = new ChestMock(block);
        block.setType(Material.IRON_BLOCK);

        assertFalse(block.getState() instanceof Chest);
        assertTrue(chest.update(true));
        assertTrue(block.getState() instanceof Chest);
    }
}
